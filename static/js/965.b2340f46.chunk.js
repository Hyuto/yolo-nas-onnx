(self.webpackChunkyolo_nas_web=self.webpackChunkyolo_nas_web||[]).push([[965],{9167:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var a=n(4165),s=n(5861),r=n(885),i=n(2791),o=n(3863),c=n.n(o),l=n(4996),u=n(5221),h=n(2982),p=n(3144),d=n(5671),f=function(e,t,n){var a=new b,s="".concat(Math.max(Math.round(Math.max(e.canvas.width,e.canvas.height)/40),14),"px Arial");e.font=s,e.textBaseline="top",t.forEach((function(t){var i=n[t.label],o=a.get(t.label),c=(100*t.probability).toFixed(1),l=(0,r.Z)(t.bounding,4),u=l[0],h=l[1],p=l[2],d=l[3];e.fillStyle=b.hexToRgba(o,.2),e.fillRect(u,h,p,d),e.strokeStyle=o,e.lineWidth=Math.max(Math.min(e.canvas.width,e.canvas.height)/200,2.5),e.strokeRect(u,h,p,d),e.fillStyle=o;var f=e.measureText(i+" - "+c+"%").width,_=parseInt(s,10),v=h-(_+e.lineWidth);e.fillRect(u-1,v<0?0:v,f+e.lineWidth,_+e.lineWidth),e.fillStyle="#ffffff",e.fillText(i+" - "+c+"%",u-1,v<0?1:v+1)}))},b=(0,p.Z)((function e(){var t=this;(0,d.Z)(this,e),this.get=function(e){return t.palette[Math.floor(e)%t.n]},this.palette=["#FF3838","#FF9D97","#FF701F","#FFB21D","#CFD231","#48F90A","#92CC17","#3DDB86","#1A9334","#00D4BB","#2C99A8","#00C2FF","#344593","#6473FF","#0018EC","#8438FF","#520085","#CB38FF","#FF95C8","#FF37C7"],this.n=this.palette.length}));b.hexToRgba=function(e,t){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?"rgba(".concat([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)].join(", "),", ").concat(t,")"):null};var _=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,s,i){var o,u,p,d,b,_,v,g,x,m,w,k,y,S,R,Z,F,M,T,C,j,O;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.preProcessing,u=i.postProcessing,n.width=t.width,n.height=t.height,(p=n.getContext("2d")).clearRect(0,0,p.canvas.width,p.canvas.height),p.drawImage(t,0,0,t.width,t.height),d=c().imread(t),b=o.run(d),_=(0,r.Z)(b,2),v=_[0],g=_[1],x=new l.Tensor("float32",v.data32F,s.inputShape),m=new l.Tensor("float32",new Float32Array([u.topk,u.iouThresh,u.scoreThresh])),w=s.net.outputNames,e.next=13,s.net.run({"input.1":x});case 13:return k=e.sent,e.next=16,s.nms.run({bboxes:k[w[0]],scores:k[w[1]],config:m});case 16:for(y=e.sent,S=y.selected,R=[],Z=0;Z<S.dims[1];Z++)F=S.data.slice(Z*S.dims[2],(Z+1)*S.dims[2]),M=u.run(F,(0,h.Z)(g)),T=(0,r.Z)(M,3),C=T[0],j=T[1],O=T[2],R.push({label:O,probability:j,bounding:C});f(p,R,u.labels),v.delete();case 22:case"end":return e.stop()}}),e)})));return function(t,n,a,s){return e.apply(this,arguments)}}(),v=JSON.parse('["person","bicycle","car","motorcycle","airplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","couch","potted plant","bed","dining table","toilet","tv","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"]'),g=function(){function e(t,n,a,s){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,d.Z)(this,e),this.baseModelURL="".concat("/yolo-nas-onnx","/model"),this.prepSteps=[{DetLongMaxRescale:null},{CenterPad:{pad_value:114}},{Standardize:{max_value:255}}],this.labels=v,this.inputShape=t,this.scoreThresh=n,this.iouThresh=a,this.topk=s,this.customMetadata=r}return(0,p.Z)(e,[{key:"_loadMetadata",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(this.baseModelURL,"/").concat(this.customMetadata));case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,this.scoreThresh=n.score_thres,this.iouThresh=n.iou_thres,this.prepSteps=n.prep_steps,this.labels=n.labels,JSON.stringify(this.inputShape)!==JSON.stringify(n.original_insz)&&alert("Model have different input shape from what included in metadata!");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.customMetadata){e.next=3;break}return e.next=3,this._loadMetadata();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,a){var s=new XMLHttpRequest;if(s.open("GET",e,!0),s.responseType="arraybuffer",t){var i=(0,r.Z)(t,2),o=i[0],c=i[1];s.onprogress=function(e){var t=e.loaded/e.total*100;c({text:o,progress:t.toFixed(2)})}}s.onload=function(){this.status>=200&&this.status<300?n(s.response):a({status:this.status,statusText:s.statusText}),n(s.response)},s.onerror=function(){a({status:this.status,statusText:s.statusText})},s.send()}))},m=n(889),w=function(){function e(t,n){(0,d.Z)(this,e),this.steps=t,this.output_shape=n}return(0,p.Z)(e,[{key:"__rescale_img",value:function(e,t,n){var a=(0,m.Z)(c().Size,(0,h.Z)(n));c().resize(e,t,a,0,0,c().INTER_LINEAR)}},{key:"_standarize",value:function(e,t,n){var a=n.max_value;return e.convertTo(t,c().CV_32F,1/a,0),null}},{key:"_normalize",value:function(e,t,n){var a=n.mean,s=n.std,r=new(c().Mat)(e.rows,e.cols,e.type(),(0,m.Z)(c().Scalar,(0,h.Z)(a)));return c().subtract(e,r,t,new(c().Mat),c().CV_32F),t.convertTo(t,c().CV_32F,1/s,0),r.delete(),null}},{key:"_det_rescale",value:function(e,t){var n=[this.output_shape[1]/e.rows,this.output_shape[0]/e.cols];return this.__rescale_img(e,t,this.output_shape),{scale_factors:n}}},{key:"_det_long_max_rescale",value:function(e,t){var n=Math.min((this.output_shape[1]-4)/e.rows,(this.output_shape[0]-4)/e.cols);if(1!==n){var a=Math.round(e.rows*n),s=Math.round(e.cols*n);this.__rescale_img(e,t,[s,a])}return{scale_factors:[n,n]}}},{key:"_bot_right_pad",value:function(e,t,n){var a=n.pad_value,s=this.output_shape[1]-e.rows,r=this.output_shape[0]-e.cols;return c().copyMakeBorder(e,t,0,s,0,r,c().BORDER_CONSTANT,new(c().Scalar)(a,a,a)),{padding:[0,s,0,r]}}},{key:"_center_pad",value:function(e,t,n){var a=n.pad_value,s=this.output_shape[1]-e.rows,r=this.output_shape[0]-e.cols,i=Math.floor(s/2),o=Math.floor(r/2);return c().copyMakeBorder(e,t,i,s-i,o,r-o,c().BORDER_CONSTANT,new(c().Scalar)(a,a,a)),{padding:[i,s-i,o,r-o]}}},{key:"_call_fn",value:function(e){return{Standardize:this._standarize.bind(this),DetRescale:this._det_rescale.bind(this),DetLongMaxRescale:this._det_long_max_rescale.bind(this),BotRightPad:this._bot_right_pad.bind(this),CenterPad:this._center_pad.bind(this),Normalize:this._normalize.bind(this)}[e]}},{key:"run",value:function(e){var t=this,n=new(c().Mat)(e.rows,e.cols,c().CV_32FC3);c().cvtColor(e,n,c().COLOR_RGBA2BGR);var a=[];this.steps.forEach((function(e){if(e){var s=(0,r.Z)(Object.entries(e)[0],2),i=s[0],o=s[1],c=o?t._call_fn(i)(n,n,o):t._call_fn(i)(n,n);a.push(c)}}));var s=c().blobFromImage(n,1,new(c().Size),new(c().Scalar),!0,!1);return n.delete(),[s,a]}}]),e}(),k=function(){function e(t,n,a,s,r){(0,d.Z)(this,e),this.steps=t,this.iouThresh=n,this.scoreThresh=a,this.topk=s,this.labels=r}return(0,p.Z)(e,[{key:"_rescale_boxes",value:function(e,t){var n=(0,r.Z)(t.scale_factors,2),a=n[0],s=n[1];return e[0]/=a,e[2]/=a,e[1]/=s,e[3]/=s,e}},{key:"_shift_bboxes",value:function(e,t){return e[0]-=t.padding[2],e[2]-=t.padding[2],e[1]-=t.padding[0],e[3]-=t.padding[0],e}},{key:"_call_fn",value:function(e){return{DetRescale:this._rescale_boxes.bind(this),DetLongMaxRescale:this._rescale_boxes.bind(this),BotRightPad:this._shift_bboxes.bind(this),CenterPad:this._shift_bboxes.bind(this),Standardize:null,Normalize:null}[e]}},{key:"run",value:function(e,t){var n=this,a=e.slice(0,4),s=e.slice(4);this.steps.toReversed().forEach((function(e){if(e){var s=Object.entries(e)[0][0],r=t.pop();n._call_fn(s)&&(a=n._call_fn(s)(a,r))}})),a[2]-=a[0],a[3]-=a[1];var r=Math.max.apply(Math,(0,h.Z)(s)),i=s.indexOf(r);return[a,r,i]}}]),e}(),y=n(184),S=function(){var e=(0,i.useState)({text:"Loading OpenCV.js",progress:null}),t=(0,r.Z)(e,2),n=t[0],o=t[1],h=(0,i.useState)(null),p=(0,r.Z)(h,2),d=p[0],f=p[1],b=(0,i.useState)(null),v=(0,r.Z)(b,2),m=v[0],S=v[1],R=(0,i.useState)(null),Z=(0,r.Z)(R,2),F=Z[0],M=Z[1],T=(0,i.useRef)(null),C=(0,i.useRef)(null),j=(0,i.useRef)(null),O="yolo_nas_s.onnx",L=new g([1,3,640,640],.25,.45,100);return c().onRuntimeInitialized=(0,s.Z)((0,a.Z)().mark((function e(){var t,n,s,r,i,c,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.init();case 2:return t=new w(L.prepSteps,[L.inputShape[3],L.inputShape[2]]),n=new k(L.prepSteps,L.iouThresh,L.scoreThresh,L.topk,L.labels),S({preProcessing:t,postProcessing:n}),e.next=7,x("".concat(L.baseModelURL,"/").concat(O),["Loading YOLO-NAS model",o]);case 7:return s=e.sent,e.next=10,l.InferenceSession.create(s);case 10:return r=e.sent,e.next=13,x("".concat(L.baseModelURL,"/nms-yolo-nas.onnx"),["Loading NMS model",o]);case 13:return i=e.sent,e.next=16,l.InferenceSession.create(i);case 16:return c=e.sent,o({text:"Warming up model...",progress:null}),u=new l.Tensor("float32",new Float32Array(L.inputShape.reduce((function(e,t){return e*t}))),L.inputShape),e.next=21,r.run({"input.1":u});case 21:f({net:r,inputShape:L.inputShape,nms:c}),o(null);case 23:case"end":return e.stop()}}),e)}))),(0,y.jsxs)("div",{className:"App",children:[n&&(0,y.jsx)(u.Z,{children:n.progress?"".concat(n.text," - ").concat(n.progress,"%"):n.text}),(0,y.jsxs)("div",{className:"header",children:[(0,y.jsx)("h1",{children:"YOLO-NAS Object Detection App"}),(0,y.jsxs)("p",{children:["YOLO-NAS object detection application live on browser powered by"," ",(0,y.jsx)("strong",{children:"onnxruntime-web"})]}),(0,y.jsxs)("p",{children:["Serving : ",(0,y.jsx)("code",{children:O})]})]}),(0,y.jsxs)("div",{className:"content",children:[(0,y.jsx)("img",{ref:C,src:"#",alt:"",style:{display:F?"block":"none"},onLoad:function(){_(C.current,j.current,d,m)}}),(0,y.jsx)("canvas",{id:"canvas",ref:j})]}),(0,y.jsx)("input",{type:"file",ref:T,accept:"image/*",style:{display:"none"},onChange:function(e){F&&(URL.revokeObjectURL(F),M(null));var t=URL.createObjectURL(e.target.files[0]);C.current.src=t,M(t)}}),(0,y.jsxs)("div",{className:"btn-container",children:[(0,y.jsx)("button",{onClick:function(){T.current.click()},children:"Open local image"}),F&&(0,y.jsx)("button",{onClick:function(){T.current.value="",C.current.src="#",URL.revokeObjectURL(F),M(null)},children:"Close image"})]})]})}},4619:function(){},3004:function(){},7897:function(){}}]);
//# sourceMappingURL=965.b2340f46.chunk.js.map